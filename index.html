<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Finch Sandbox Demo</title>
</head>
<body>
  <h1>Finch Sandbox Demo</h1>

  <label for="provider">Choose Provider:</label>
  <select id="provider">
    <option value="gusto">Gusto</option>
    <option value="adp">ADP</option>
    <option value="paychex">Paychex</option>
  </select>
  <button id="generate">Generate Data</button>

  <hr />

  <button id="load-company" disabled>Load Company Info</button>
  <button id="load-employees" disabled>Load Employees</button>

  <pre id="output">Select a provider and click "Generate Data".</pre>

  <script>
    const output = document.getElementById("output");

    function formatCompanyData(data) {
      return `
        <h3>Company Information</h3>
        <p><strong>Company Name:</strong> ${data.legal_name || 'N/A'}</p>
        <p><strong>Entity Type:</strong> ${data.entity?.type || 'N/A'}</p>
        <p><strong>Entity Subtype:</strong> ${data.entity?.subtype || 'N/A'}</p>
        <p><strong>EIN:</strong> ${data.ein || 'N/A'}</p>
        <p><strong>Primary Email:</strong> ${data.primary_email || 'N/A'}</p>
        <p><strong>Primary Phone:</strong> ${data.primary_phone_number || 'N/A'}</p>
        ${data.locations && data.locations[0] ? `
          <h4>Primary Location</h4>
          <p><strong>Address:</strong> ${data.locations[0].line1 || ''} ${data.locations[0].line2 || ''}</p>
          <p><strong>City:</strong> ${data.locations[0].city || 'N/A'}</p>
          <p><strong>State:</strong> ${data.locations[0].state || 'N/A'}</p>
          <p><strong>Postal Code:</strong> ${data.locations[0].postal_code || 'N/A'}</p>
          <p><strong>Country:</strong> ${data.locations[0].country || 'N/A'}</p>
        ` : ''}
      `;
    }

    function formatEmployeeData(data) {
      let html = `<h3>Employee Directory (${data.individuals?.length || 0} employees)</h3>`;
      
      if (data.individuals && data.individuals.length > 0) {
        data.individuals.forEach((employee, index) => {
          html += `
            <div style="border: 1px solid #ddd; margin: 10px 0; padding: 10px; border-radius: 5px;">
              <h4>Employee ${index + 1}</h4>
              <p><strong>ID:</strong> ${employee.id || 'N/A'}</p>
              <p><strong>First Name:</strong> ${employee.first_name || 'N/A'}</p>
              <p><strong>Middle Name:</strong> ${employee.middle_name || 'N/A'}</p>
              <p><strong>Last Name:</strong> ${employee.last_name || 'N/A'}</p>
              <p><strong>Email:</strong> ${employee.emails?.[0]?.data || 'N/A'}</p>
              <p><strong>Phone:</strong> ${employee.phone_numbers?.[0]?.data || 'N/A'}</p>
              <p><strong>Manager ID:</strong> ${employee.manager?.id || 'N/A'}</p>
              <p><strong>Department:</strong> ${employee.department?.name || 'N/A'}</p>
              <p><strong>Is Active:</strong> ${employee.is_active ? 'Yes' : 'No'}</p>
            </div>
          `;
        });
      } else {
        html += '<p>No employee data available.</p>';
      }
      
      return html;
    }
    const loadCompanyBtn = document.getElementById("load-company");
    const loadEmployeesBtn = document.getElementById("load-employees");
    const providerSelect = document.getElementById("provider");

    function disableDataButtons() {
      loadCompanyBtn.disabled = true;
      loadEmployeesBtn.disabled = true;
    }

    async function fetchData(endpoint) {
      const provider = providerSelect.value;
      const response = await fetch(`/${endpoint}/${provider}`);
      const data = await response.json();
      return data;
    }

    document.getElementById("generate").onclick = async () => {
      const provider = providerSelect.value;
      output.textContent = "Generating data...";
      try {
        const data = await fetchData("generate");
        
        // Display simple success message instead of JSON
        output.textContent = `${provider.charAt(0).toUpperCase() + provider.slice(1)} data generated successfully!`;

        // Enable buttons after success
        loadCompanyBtn.disabled = false;
        loadEmployeesBtn.disabled = false;
      } catch (err) {
        output.textContent = "Error generating data: " + err;
        disableDataButtons();
      }
    };

    loadCompanyBtn.onclick = async () => {
      output.innerHTML = "Loading company info...";
      try {
        const data = await fetchData("company");
        output.innerHTML = formatCompanyData(data);
      } catch (err) {
        output.textContent = "Error loading company info: " + err;
      }
    };

    loadEmployeesBtn.onclick = async () => {
      output.innerHTML = "Loading employees...";
      try {
        const data = await fetchData("employees");
        output.innerHTML = formatEmployeeData(data);
      } catch (err) {
        output.textContent = "Error loading employees: " + err;
      }
    };

    // Reset buttons whenever provider changes
    providerSelect.onchange = () => {
      output.textContent = `Provider changed to "${providerSelect.value}". Please click "Generate Data".`;
      disableDataButtons();
    };
  </script>
</body>
</html>